<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vantage Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        vantage: { 900: '#022c22', 800: '#064e3b', 600: '#059669', 500: '#10b981', 100: '#d1fae5', 50: '#f0fdf4' }
                    },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    boxShadow: { 'soft': '0 5px 20px -5px rgba(0,0,0,0.05)', 'glow': '0 0 15px rgba(16, 185, 129, 0.2)' },
                    fontSize: { 'xxs': '0.65rem' }
                }
            }
        }
    </script>
    <script type="importmap">{"imports": {"react": "https://esm.sh/react@18.2.0", "react-dom/client": "https://esm.sh/react-dom@18.2.0/client", "lucide-react": "https://esm.sh/lucide-react@0.292.0"}}</script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; overscroll-behavior-y: none; -webkit-tap-highlight-color: transparent; background-color: #f8fafc; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .no-scrollbar::-webkit-scrollbar { display: none; } .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 1rem); }
        .toggle-checkbox:checked { right: 0; border-color: #10b981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10b981; }
    </style>
</head>
<body class="bg-slate-50 h-[100dvh] w-screen overflow-hidden text-slate-800">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Calendar, User, Send, CheckCircle, XCircle, Settings, AlertCircle, LogOut, Shield, List, 
          RefreshCw, Clock, ChevronRight, Lock, PieChart, Activity, Filter, Building2, Briefcase, 
          Users, Edit3, MessageSquare, Bell, Trash2, LayoutGrid, Hexagon, Key, DollarSign, UserMinus, UserPlus, Mail, CheckSquare, XSquare, UserCog, Archive, RotateCcw, FileText
        } from 'lucide-react';

        const APPS_SCRIPT_TEMPLATE = `/* See Code.gs for full content */`;

        function LeavePortal() {
          const DEPARTMENTS = ["Brokerage", "Safety", "Local", "Inbound Custom", "Accounting", "Outbound", "Warehouse"];
          const DEFAULT_LIMITS = { 'Earned': 15, 'Sick': 10, 'Personal Paid': 5, 'Personal Unpaid': 5 };

          const [view, setView] = useState('login'); 
          const [currentUser, setCurrentUser] = useState(null);
          const [activeTab, setActiveTab] = useState('dashboard');
          const [adminSubTab, setAdminSubTab] = useState('Pending');
          const [leaves, setLeaves] = useState([]);
          const [allUsers, setAllUsers] = useState([]); 
          
          const [scriptUrl, setScriptUrl] = useState('https://script.google.com/macros/s/AKfycbywHdk55GxXQ_FPDdhZEJaalMnqYkBZmRbxFpCMuYzZNNbd_cqAiuxFsaSdsHtTLvLz/exec');
          
          const [isLoading, setIsLoading] = useState(false);
          const [notification, setNotification] = useState(null);
          const [email, setEmail] = useState('');
          const [password, setPassword] = useState('');
          const [name, setName] = useState(''); 
          const [isLoginLoading, setIsLoginLoading] = useState(false);

          const [editingUser, setEditingUser] = useState(null); 
          const [allocations, setAllocations] = useState({ earned: 0, sick: 0, personalPaid: 0, personalUnpaid: 0 });
          const [editUserRole, setEditUserRole] = useState('user');
          const [editUserDept, setEditUserDept] = useState('Unassigned');
          const [editUserActive, setEditUserActive] = useState(false);

          const [actionModal, setActionModal] = useState(null); 
          const [adminMessage, setAdminMessage] = useState('');
          const [inAppNotifs, setInAppNotifs] = useState([]);
          const [showNotifPanel, setShowNotifPanel] = useState(false);
          const prevLeavesRef = useRef([]); 
          const [showPasswordModal, setShowPasswordModal] = useState(false);
          const [newPassword, setNewPassword] = useState('');
          
          const [emailEnabled, setEmailEnabled] = useState(true);
          const [showAddUserModal, setShowAddUserModal] = useState(false);
          const [newUser, setNewUser] = useState({ name: '', email: '', password: '', role: 'user', department: 'Brokerage', earned: 15, sick: 10, personalPaid: 5, personalUnpaid: 5 });
          
          const [showArchive, setShowArchive] = useState(false);

          const [formData, setFormData] = useState({ department: 'Brokerage', leaveType: 'Earned', startDate: '', endDate: '', reason: '' });

          const getGreeting = () => {
            const hour = new Date().getHours();
            if (hour < 12) return "Good Morning";
            if (hour < 18) return "Good Afternoon";
            return "Good Evening";
          };

          const formatDate = (dateString) => {
            if (!dateString) return '';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
          };

          const isSuperAdmin = currentUser?.role === 'admin' && currentUser?.department === 'All';

          useEffect(() => {
            const meta1 = document.createElement('meta'); meta1.name = "apple-mobile-web-app-capable"; meta1.content = "yes"; document.head.appendChild(meta1);
            const meta2 = document.createElement('meta'); meta2.name = "apple-mobile-web-app-status-bar-style"; meta2.content = "black-translucent"; document.head.appendChild(meta2);
            if ("Notification" in window && Notification.permission !== "granted") Notification.requestPermission();
            
            const savedUrl = localStorage.getItem('google_script_url_v2');
            if (savedUrl) setScriptUrl(savedUrl);
            const savedNotifs = localStorage.getItem('leave_app_notifications');
            if (savedNotifs) setInAppNotifs(JSON.parse(savedNotifs));

            const sessionUser = localStorage.getItem('vantage_user_session_v2');
            if (sessionUser) {
                const user = JSON.parse(sessionUser);
                setCurrentUser(user);
                setEmailEnabled(user.emailEnabled);
                setView(user.role === 'admin' ? 'admin' : 'user');
            } else {
                setView('login');
            }
          }, []);

          useEffect(() => { localStorage.setItem('leave_app_notifications', JSON.stringify(inAppNotifs)); }, [inAppNotifs]);

          useEffect(() => {
            if (view !== 'login' && view !== 'signup' && view !== 'loading' && scriptUrl) {
                fetchLeaves();
                if (isSuperAdmin) fetchUsersList();
                const interval = setInterval(() => fetchLeaves(true), 15000);
                return () => clearInterval(interval);
            }
          }, [view, scriptUrl, currentUser]);

          useEffect(() => {
            if (leaves.length === 0 || prevLeavesRef.current.length === 0) { prevLeavesRef.current = leaves; return; }
            const newNotifs = [];
            if (currentUser?.role === 'admin') {
                const getPendingCount = (list) => list.filter(l => l.status === 'Pending' && (currentUser.department === 'All' || l.department === currentUser.department)).length;
                if (getPendingCount(leaves) > getPendingCount(prevLeavesRef.current)) {
                    newNotifs.push({ id: Date.now(), title: "New Request", msg: "An employee applied for leave.", time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), read: false });
                    showToast("ðŸ”” New Leave Request!", "success");
                }
            }
            if (currentUser?.role === 'user') {
                const myCurrentLeaves = leaves.filter(l => l.email === currentUser.email);
                myCurrentLeaves.forEach(currLeave => {
                    const prevLeave = prevLeavesRef.current.find(p => p.id === currLeave.id);
                    if (prevLeave && prevLeave.status === 'Pending' && currLeave.status !== 'Pending') {
                        const isApproved = currLeave.status === 'Approved';
                        newNotifs.push({ id: Date.now() + Math.random(), title: isApproved ? "Leave Approved" : "Leave Rejected", msg: `Your ${currLeave.leaveType} was ${currLeave.status}.`, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), read: false, type: isApproved ? 'success' : 'error' });
                        showToast(isApproved ? "ðŸŽ‰ Approved!" : "âš ï¸ Update Received");
                    }
                });
            }
            if (newNotifs.length > 0) setInAppNotifs(prev => [...newNotifs, ...prev]);
            prevLeavesRef.current = leaves;
          }, [leaves, currentUser]);

          const showToast = (msg, type = 'success') => { setNotification({ msg, type }); setTimeout(() => setNotification(null), 4000); };
          const getDaysDiff = (start, end) => { const d1 = new Date(start); const d2 = new Date(end); return Math.ceil(Math.abs(d2 - d1) / (1000 * 60 * 60 * 24)) + 1 || 0; };

          const getLeaveStats = () => {
            const stats = { 'Earned': 0, 'Sick': 0, 'Personal Paid': 0, 'Personal Unpaid': 0 };
            leaves.filter(l => l.email === currentUser.email && l.status === 'Approved').forEach(l => {
                if (stats[l.leaveType] !== undefined) stats[l.leaveType] += getDaysDiff(l.startDate, l.endDate);
            });
            return stats;
          };
          
          const getAdminCategoryStats = () => {
            if (!currentUser) return { Earned: 0, Sick: 0, PersonalPaid: 0, PersonalUnpaid: 0 };
            const stats = { Earned: 0, Sick: 0, PersonalPaid: 0, PersonalUnpaid: 0 };
            const deptLeaves = leaves.filter(l => (currentUser.department === 'All' || l.department === currentUser.department) && l.status === 'Approved');
            deptLeaves.forEach(l => {
                const days = getDaysDiff(l.startDate, l.endDate);
                if (l.leaveType === 'Earned') stats.Earned += days;
                else if (l.leaveType === 'Sick') stats.Sick += days;
                else if (l.leaveType === 'Personal Paid') stats.PersonalPaid += days;
                else if (l.leaveType === 'Personal Unpaid') stats.PersonalUnpaid += days;
            });
            return stats;
          };

          const calculateUserTakenLeaves = (userEmail) => {
             return leaves.filter(l => l.email === userEmail && l.status === 'Approved').reduce((acc, leave) => acc + getDaysDiff(leave.startDate, leave.endDate), 0);
          };
          
          const calculateUserLeaveBreakdown = (userEmail) => {
            const breakdown = { Earned: 0, Sick: 0, 'Personal Paid': 0, 'Personal Unpaid': 0, Total: 0 };
            leaves.filter(l => l.email === userEmail && l.status === 'Approved').forEach(l => {
                const days = getDaysDiff(l.startDate, l.endDate);
                if (breakdown[l.leaveType] !== undefined) {
                    breakdown[l.leaveType] += days;
                    breakdown.Total += days;
                }
            });
            return breakdown;
          };

          const fetchUsersList = async () => { try { const r = await fetch(scriptUrl + "?action=users"); const d = await r.json(); if (d.status === 'success') { setAllUsers(d.data); localStorage.setItem('vantage_cached_users_list_v2', JSON.stringify(d.data)); } } catch (e) {} };
          const fetchLeaves = async (silent = false) => { if (!scriptUrl) return; if (!silent) setIsLoading(true); try { const r = await fetch(scriptUrl); const d = await r.json(); if (d.status === 'success') { setLeaves(d.data); localStorage.setItem('vantage_cached_leaves_v2', JSON.stringify(d.data)); } } catch (e) { if(!silent) showToast("Sync Error", "error"); } finally { if (!silent) setIsLoading(false); } };

          const handleLogin = async (e) => {
            e.preventDefault(); setIsLoginLoading(true);
            if (!scriptUrl) { showToast("Database URL missing.", "error"); setIsLoginLoading(false); return; }
            try {
                const r = await fetch(scriptUrl + "?action=users"); const d = await r.json();
                if (d.status === 'success') {
                    const u = d.data.find(u => String(u.email).toLowerCase() === String(email).toLowerCase() && String(u.password) === String(password));
                    if (u) {
                        if (u.isDeleted) { showToast("Account Archived.", "error"); setIsLoginLoading(false); return; }
                        if (u.isActive === false) { showToast("Account Pending Approval", "error"); setIsLoginLoading(false); return; }
                        
                        const userObj = { name: u.name, email: u.email, role: u.role, department: u.department || 'All', limits: u.limits, emailEnabled: u.emailEnabled };
                        localStorage.setItem('vantage_user_session_v2', JSON.stringify(userObj));
                        
                        setCurrentUser(userObj);
                        setEmailEnabled(u.emailEnabled);
                        setView(u.role === 'admin' ? 'admin' : 'user'); setActiveTab('dashboard');
                    } else showToast("Invalid Credentials", "error");
                } else showToast("Database Error", "error");
            } catch (error) { showToast("Connection Failed", "error"); } finally { setIsLoginLoading(false); }
          };

          const handleSignup = async (e) => {
            e.preventDefault();
            setIsLoginLoading(true);
            try {
                const resp = await fetch(scriptUrl, { 
                    method: 'POST', mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ 
                        action: 'register', 
                        name, email, password 
                    }) 
                });
                showToast("Signup Successful! Wait for Admin approval.");
                setView('login');
                setName(''); setEmail(''); setPassword('');
            } catch (e) { showToast("Signup Failed", "error"); } finally { setIsLoginLoading(false); }
          };

          const toggleEmailNotifications = async () => {
              const newState = !emailEnabled;
              setEmailEnabled(newState);
              const updatedUser = { ...currentUser, emailEnabled: newState };
              setCurrentUser(updatedUser);
              localStorage.setItem('vantage_user_session_v2', JSON.stringify(updatedUser));
              try {
                  await fetch(scriptUrl, {
                      method: 'POST', mode: 'no-cors', 
                      headers: { 'Content-Type': 'application/json' }, 
                      body: JSON.stringify({ action: 'toggle_email_pref', email: currentUser.email, enabled: newState })
                  });
                  showToast(newState ? "Email Alerts ON" : "Email Alerts OFF");
              } catch(e) { setEmailEnabled(!newState); showToast("Failed to update preference", "error"); }
          };

          const handleUpdateUser = async () => {
             if(!editingUser) return;
             setIsLoading(true);
             try {
                await fetch(scriptUrl, { 
                    method: 'POST', mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ 
                        action: 'admin_update_user', 
                        email: editingUser.email, 
                        role: editUserRole, 
                        department: editUserDept, 
                        isActive: editUserActive,
                        ...allocations 
                    }) 
                });
                showToast("User Updated!"); 
                setAllUsers(prevUsers => prevUsers.map(u => u.email === editingUser.email ? {
                    ...u, 
                    role: editUserRole, 
                    department: editUserDept, 
                    isActive: editUserActive,
                    limits: allocations
                } : u));
                setEditingUser(null);
             } catch (e) { showToast("Update Failed", "error"); } finally { setIsLoading(false); }
          };

          const handleUserStatusChange = async (targetUser, isDeleted) => {
              if(!targetUser) return;
              setIsLoading(true);
              try {
                await fetch(scriptUrl, { 
                    method: 'POST', mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ 
                        action: 'set_user_deleted_status', 
                        email: targetUser.email, 
                        isDeleted: isDeleted 
                    }) 
                });
                showToast(isDeleted ? "User Archived" : "User Restored & Activated");
                setAllUsers(prevUsers => prevUsers.map(u => 
                    u.email === targetUser.email ? {
                        ...u, 
                        isDeleted: isDeleted,
                        isActive: isDeleted ? u.isActive : true 
                    } : u
                ));
                setEditingUser(null);
              } catch (e) { showToast("Action Failed", "error"); } finally { setIsLoading(false); }
          };

          const handleChangePassword = async () => {
             if(!newPassword) return; setIsLoading(true);
             try {
                await fetch(scriptUrl, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'change_password', email: currentUser.email, newPassword: newPassword }) });
                showToast("Password Updated!"); setShowPasswordModal(false); setNewPassword('');
             } catch (e) { showToast("Update Failed", "error"); } finally { setIsLoading(false); }
          };

          const handleLogout = () => { 
              setCurrentUser(null); 
              setView('login'); 
              setEmail(''); 
              setPassword(''); 
              setInAppNotifs([]);
              localStorage.removeItem('vantage_user_session_v2');
          };

          const handleApply = async (e) => {
            e.preventDefault();
            const days = getDaysDiff(formData.startDate, formData.endDate);
            const stats = getLeaveStats();
            const limit = currentUser.limits ? 
                (formData.leaveType === 'Earned' ? currentUser.limits.earned : 
                 formData.leaveType === 'Sick' ? currentUser.limits.sick : 
                 formData.leaveType === 'Personal Paid' ? currentUser.limits.personalPaid : 
                 currentUser.limits.personalUnpaid) 
                 : DEFAULT_LIMITS[formData.leaveType];

            const used = stats[formData.leaveType] || 0;
            if (used + days > limit) return showToast(`Insufficient Balance! Limit: ${limit}`, 'error');

            setIsLoading(true);
            try {
              await fetch(scriptUrl, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'apply', id: 'L' + Date.now(), name: currentUser.name, email: currentUser.email, department: currentUser.department, ...formData }) });
              const newLeave = { 
                  id: 'L' + Date.now(), 
                  name: currentUser.name, 
                  email: currentUser.email, 
                  department: currentUser.department, 
                  status: 'Pending', 
                  ...formData 
              };
              setLeaves([newLeave, ...leaves]);
              setFormData({ ...formData, reason: '', startDate: '', endDate: '' }); setActiveTab('history'); showToast("Application Sent!"); fetchLeaves(true);
            } catch (error) { showToast("Network Error", "error"); } finally { setIsLoading(false); }
          };

          const initiateAdminAction = (id, status) => { setActionModal({ id, status }); setAdminMessage(''); };
          const confirmAdminAction = async () => {
            if (!actionModal) return;
            setLeaves(leaves.map(l => l.id === actionModal.id ? { ...l, status: actionModal.status, adminMessage } : l)); setActionModal(null);
            try { await fetch(scriptUrl, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'update', id: actionModal.id, status: actionModal.status, message: adminMessage }) }); showToast(`Request ${actionModal.status}`); } catch (e) { showToast("Failed to sync", "error"); }
          };

          const handleSaveAllocation = async () => {
             if(!editingUser) return; setIsLoading(true);
             try {
                await fetch(scriptUrl, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'update_user_quota', email: editingUser.email, ...allocations }) });
                showToast("Quotas Updated!"); setAllUsers(allUsers.map(u => u.email === editingUser.email ? {...u, limits: allocations} : u)); setEditingUser(null);
             } catch (e) { showToast("Update Failed", "error"); } finally { setIsLoading(false); }
          };

          const handleAddUser = async () => {
            if(!newUser.name || !newUser.email || !newUser.password) return showToast("Fill all fields", "error");
            setIsLoading(true);
            try {
                const resp = await fetch(scriptUrl, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'add_user', ...newUser }) });
                showToast("User Added Successfully!");
                setShowAddUserModal(false);
                fetchUsersList(); 
                setNewUser({ name: '', email: '', password: '', role: 'user', department: 'Brokerage', earned: 15, sick: 10, personalPaid: 5, personalUnpaid: 5 });
            } catch (e) { showToast("Failed to add user", "error"); } finally { setIsLoading(false); }
          };

          const openAllocationModal = (user) => {
              setEditingUser(user);
              const limits = user.limits || {};
              setAllocations({
                  earned: limits.earned || 15,
                  sick: limits.sick || 10,
                  personalPaid: limits.personalPaid || 5,
                  personalUnpaid: limits.personalUnpaid || 5
              });
              setEditUserRole(user.role);
              setEditUserDept(user.department);
              setEditUserActive(user.isActive);
          };

          const getFilteredLeavesForAdmin = () => {
             const deptLeaves = leaves.filter(l => currentUser.department === 'All' || l.department === currentUser.department);
             return { 
                 pending: deptLeaves.filter(l => l.status === 'Pending').length,
                 approved: deptLeaves.filter(l => l.status === 'Approved').length,
                 rejected: deptLeaves.filter(l => l.status === 'Rejected').length,
                 list: deptLeaves.filter(l => l.status === adminSubTab)
             };
          };

          // --- Components ---
          const BalanceCard = ({ type, used, total, icon: Icon, colorClass, bgClass, barClass }) => {
            const remaining = total - used;
            const percent = Math.min((used / total) * 100, 100);
            return (
              <div className="bg-white p-4 rounded-[1.5rem] shadow-soft border border-slate-100 relative overflow-hidden group min-w-[130px] md:min-w-0 shrink-0 snap-center">
                <div className={`absolute -right-3 -top-3 p-2 opacity-5 ${colorClass} transform scale-125`}><Icon size={60} /></div>
                <div className="flex justify-between items-start mb-3 relative z-10">
                  <div>
                    <div className={`h-8 w-8 rounded-xl flex items-center justify-center mb-2 ${bgClass} ${colorClass}`}><Icon size={16} /></div>
                    <p className="text-[9px] font-bold text-slate-400 uppercase tracking-wider">{type}</p>
                    <h3 className="text-2xl font-extrabold text-slate-800 mt-0.5">{remaining}</h3>
                  </div>
                </div>
                <div className="w-full bg-slate-100 rounded-full h-1 mt-1 overflow-hidden"><div className={`h-1 rounded-full ${barClass}`} style={{ width: `${percent}%` }}></div></div>
                <p className="text-[9px] text-right mt-1.5 text-slate-400 font-medium">{used} / {total} Used</p>
              </div>
            );
          };
          
          const AdminStatsCard = ({ title, value, icon: Icon, colorClass }) => (
              <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-3 flex-1 min-w-[120px]">
                  <div className={`p-2.5 rounded-xl ${colorClass} bg-opacity-10`}><Icon size={18} className={colorClass.replace('bg-', 'text-')}/></div>
                  <div><p className="text-[9px] font-bold text-slate-400 uppercase tracking-wider">{title}</p><h3 className="text-xl font-bold text-slate-800">{value}</h3></div>
              </div>
          );

          const LeaveCard = ({ leave, isAdmin, onAction }) => (
            <div className="bg-white p-4 rounded-[1.25rem] shadow-soft border border-slate-100 mb-3 transition-all hover:shadow-md">
              <div className="flex justify-between items-start mb-3">
                <div className="flex gap-3 items-center">
                  <div className={`h-10 w-10 rounded-xl flex items-center justify-center text-white font-bold shadow-md shrink-0 ${leave.leaveType === 'Sick' ? 'bg-rose-500' : leave.leaveType === 'Earned' ? 'bg-emerald-500' : 'bg-indigo-500'}`}>{leave.name.charAt(0)}</div>
                  <div><div className="font-bold text-slate-800 text-sm">{leave.name}</div><div className="flex items-center gap-2 text-xs text-slate-500 font-medium mt-0.5"><span className="bg-slate-50 px-1.5 py-0.5 rounded-md">{leave.department}</span><span>{leave.leaveType}</span></div></div>
                </div>
                <span className={`px-2 py-1 rounded-lg text-[10px] font-bold border ${leave.status === 'Approved' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' : leave.status === 'Rejected' ? 'bg-rose-50 text-rose-600 border-rose-100' : 'bg-amber-50 text-amber-600 border-amber-100'}`}>{leave.status}</span>
              </div>
              <div className="pl-0.5">
                <div className="flex items-center text-xs text-slate-600 bg-slate-50 p-3 rounded-xl border border-slate-100">
                   <div className="flex-1"><div className="flex items-center gap-2 mb-1"><Calendar size={14} className="text-slate-400"/><span className="font-semibold text-slate-700">{formatDate(leave.startDate)} <span className="text-slate-400 mx-1 font-normal">to</span> {formatDate(leave.endDate)}</span></div>{leave.reason && <div className="text-slate-500 italic pl-6 text-[10px] line-clamp-1">"{leave.reason}"</div>}</div>
                   <div className="text-right pl-3 border-l border-slate-200 ml-3"><span className="block font-extrabold text-lg text-vantage-600">{getDaysDiff(leave.startDate, leave.endDate)}</span><span className="text-[9px] uppercase text-slate-400 font-bold">Days</span></div>
                </div>
                {leave.adminMessage && <div className="mt-2 p-2.5 bg-blue-50/50 rounded-xl border border-blue-100 flex items-start gap-2"><MessageSquare size={14} className="text-blue-500 mt-0.5 shrink-0"/><div><p className="text-[9px] text-blue-600 font-bold uppercase tracking-wide mb-0.5">Admin</p><p className="text-[11px] text-slate-700">"{leave.adminMessage}"</p></div></div>}
                {isAdmin && leave.status === 'Pending' && (
                  <div className="flex gap-2 mt-3"><button onClick={() => onAction(leave.id, 'Rejected')} className="flex-1 py-2.5 bg-white border border-rose-100 text-rose-600 rounded-xl text-xs font-bold hover:bg-rose-50 flex items-center justify-center gap-2 transition-all shadow-sm"><XCircle size={14}/> Reject</button><button onClick={() => onAction(leave.id, 'Approved')} className="flex-1 py-2.5 bg-vantage-500 text-white rounded-xl text-xs font-bold shadow-md hover:bg-vantage-600 flex items-center justify-center gap-2 transition-all"><CheckCircle size={14}/> Approve</button></div>
                )}
              </div>
            </div>
          );

          const AdminFilterBtn = ({ label, count, active, onClick, activeBg }) => (
            <button onClick={onClick} className={`flex-1 py-3 rounded-xl text-xs font-bold transition-all border flex flex-col items-center justify-center gap-0.5 ${active ? `${activeBg} text-white border-transparent shadow-md transform -translate-y-0.5` : 'bg-white text-slate-500 border-slate-100 hover:bg-slate-50'}`}>
              <span>{label}</span><span className={`px-2 py-0.5 rounded-full text-[9px] ${active ? 'bg-white/20' : 'bg-slate-100 text-slate-600'}`}>{count}</span>
            </button>
          );

          const SidebarLink = ({ id, icon: Icon, label, active, set, action }) => (
              <button 
                onClick={() => action ? action() : set(id)}
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${active === id && !action ? 'bg-emerald-500 text-white shadow-md' : 'text-slate-300 hover:bg-white/5 hover:text-white'}`}
              >
                  <Icon size={18} />
                  <span className="text-sm font-medium">{label}</span>
              </button>
        );

        const NavBtn = ({ id, icon: Icon, label, active, set, action, danger }) => (
          <button onClick={() => action ? action() : set(id)} className={`flex flex-col items-center justify-center w-full h-full pt-0.5 transition-all duration-300 group relative ${active === id && !action ? 'text-vantage-600 -translate-y-0.5' : 'text-slate-400 hover:text-slate-600'}`}>
            <div className={`p-1.5 rounded-xl mb-0.5 transition-all duration-300 ${active === id && !action ? 'bg-vantage-50 shadow-sm scale-105' : 'bg-transparent group-hover:bg-slate-50'} ${danger ? 'hover:bg-rose-50 hover:text-rose-500' : ''}`}><Icon size={20} strokeWidth={active === id && !action ? 2.5 : 2} /></div>
            <span className="text-[9px] font-bold tracking-wide opacity-90">{label}</span>
            {active === id && !action && <span className="absolute -bottom-0.5 w-1 h-1 bg-vantage-600 rounded-full"></span>}
          </button>
        );

        const root = createRoot(document.getElementById('root'));
        root.render(<LeavePortal />);
    </script>
</body>
</html>
